---
import { getCollection } from 'astro:content';
import DocumentoBase from '../layouts/DocumentoBase.astro';
import FormularioSolicitud from '../components/FormularioSolicitud.astro';
import { sortSections } from '../utils/sectionHelpers';

const sections = await getCollection('sections');
const sortedSections = sortSections(sections);

const title = "SMS Legal - Infraestructura SMS con diligencia RGPD/LSSI";
const description = "Servicio técnico de envío SMS para negocios locales con verificación Lista Robinson y trazabilidad RGPD. Sin claims, sin promesas. Solo infraestructura legal.";

const professionalServiceSchema = {
  "@context": "https://schema.org",
  "@type": "ProfessionalService",
  "name": "SMS Infrastructure",
  "description": description,
  "url": "https://smslegal.es",
  "areaServed": {
    "@type": "Country",
    "name": "España"
  },
  "priceRange": "€€"
};

const offerSchema = {
  "@context": "https://schema.org",
  "@type": "Offer",
  "name": "Plan Único SMS Infrastructure",
  "description": "Envío de hasta 10.000 SMS/mes con verificación Lista Robinson y compliance RGPD",
  "price": "199",
  "priceCurrency": "EUR",
  "availability": "https://schema.org/PreOrder"
};
---

<DocumentoBase title={title} description={description}>
  <!-- Schema.org JSON-LD -->
  <script is:inline type="application/ld+json" set:html={JSON.stringify(professionalServiceSchema)} />
  <script is:inline type="application/ld+json" set:html={JSON.stringify(offerSchema)} />

  <!-- Contenedor principal CON BORDE ÚNICO -->
  <main class="w-full py-8 sm:py-12">
    <div class="max-w-doc mx-auto px-4 sm:px-6">
      <!-- BORDE ÚNICO que rodea TODO el contenido -->
      <div class="border border-doc-border rounded-sm p-8 sm:p-12 bg-white">
        
        <!-- Todas las secciones DENTRO del borde único -->
        {sortedSections.map(async (section) => {
          const { Content } = await section.render();
          const isFormularioSection = section.data.tipo === 'formulario-cta';
          
          return (
            <section class="mb-8 sm:mb-12 last:mb-0">
              <article class="prose-doc">
                <Content />
                {isFormularioSection && <FormularioSolicitud />}
              </article>
            </section>
          );
        })}
        
      </div>
    </div>
  </main>
</DocumentoBase>

<style is:global>
  /* Estilos prose-doc para contenido markdown */
  .prose-doc {
    color: var(--doc-text);
  }

  .prose-doc h1 {
    font-size: 34px;
    font-family: 'IBM Plex Serif', Georgia, serif;
    font-weight: 600;
    line-height: 1.3;
    margin-bottom: 1rem;
    color: var(--doc-text);
  }

  .prose-doc h2 {
    font-size: 26px;
    font-family: 'IBM Plex Serif', Georgia, serif;
    font-weight: 600;
    line-height: 1.3;
    margin-bottom: 1rem;
    margin-top: 0;
    color: var(--doc-text);
  }

  .prose-doc h3 {
    font-size: 20px;
    font-family: 'IBM Plex Serif', Georgia, serif;
    font-weight: 600;
    line-height: 1.4;
    margin-bottom: 0.75rem;
    margin-top: 1.5rem;
    color: var(--doc-text);
  }

  .prose-doc p {
    margin-bottom: 1rem;
    line-height: 1.7;
    font-size: 16px;
  }

  .prose-doc ul, 
  .prose-doc ol {
    margin-left: 1.5rem;
    margin-bottom: 1rem;
    line-height: 1.7;
  }

  .prose-doc li {
    margin-bottom: 0.5rem;
    line-height: 1.7;
  }

  .prose-doc strong {
    font-weight: 600;
    color: var(--doc-text);
  }

  .prose-doc a {
    color: var(--doc-link);
    text-decoration: underline;
  }

  .prose-doc a:hover {
    opacity: 0.8;
  }

  .prose-doc code {
    font-family: 'IBM Plex Mono', 'Courier New', monospace;
    font-size: 14px;
    background-color: var(--doc-bg-alt);
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
  }

  .prose-doc hr {
    border: 0;
    border-top: 1px solid var(--doc-border);
    margin: 2rem 0;
  }

  .prose-doc blockquote {
    padding-left: 1.5rem;
    border-left: 4px solid var(--doc-border);
    color: var(--doc-secondary);
    font-style: italic;
  }

  .prose-doc table {
    width: 100%;
    border-collapse: collapse;
    margin: 1rem 0;
  }

  .prose-doc th,
  .prose-doc td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid var(--doc-border);
  }

  .prose-doc th {
    background-color: var(--doc-bg-alt);
    font-weight: 600;
  }
</style>
