---
import DocumentoBase from '../../layouts/DocumentoBase.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog');
  return blogPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content, headings } = await post.render();
const h2Headings = headings.filter(h => h.depth === 2);

const title = post.data.title;
const description = post.data.description;
const category = post.data.category;
const pubDate = post.data.pubDate;
const author = post.data.author;
const slug = post.slug;

const formattedDate = new Date(pubDate).toLocaleDateString('es-ES', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});

// Calculate reading time (approx. 200 words per minute)
const wordCount = post.body.split(/\s+/).length;
const readingTime = Math.ceil(wordCount / 200);

// SEO Metadata
const schemaOrg = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": title,
  "description": description,
  "author": {
    "@type": "Organization",
    "name": author
  },
  "publisher": {
    "@type": "Organization",
    "name": "SMS Legal",
    "url": "https://smslegal.es"
  },
  "datePublished": new Date(pubDate).toISOString().split('T')[0],
  "dateModified": new Date(pubDate).toISOString().split('T')[0]
};
---

<DocumentoBase
  title={title}
  description={description}
  ogType="article"
  ogUrl={`https://smslegal.es/blog/${slug}`}
  schemaOrg={schemaOrg}
>

  <!-- TOC/√çNDICE ARRIBA -->
  <nav class="toc-accordion" style="max-width: 72ch; margin: 2rem auto 3rem auto; padding: 1.5rem; background: var(--doc-bg-alt); border: 1px solid var(--doc-border); border-radius: 0.5rem;">
    <details style="cursor: pointer;">
      <summary style="font-family: 'IBM Plex Serif', serif; font-size: 1.125rem; font-weight: 600; color: #1a1a1a; text-transform: uppercase; letter-spacing: 0.05em;">
        üìë √çndice de Contenidos
      </summary>
      <ul style="list-style: none; padding: 1.5rem 0 0 0; margin: 0; font-size: 0.875rem; line-height: 1.8; font-family: 'IBM Plex Sans', sans-serif;">
        {h2Headings.map((heading) => (
          <li>
            <a href={`#${heading.slug}`} style="color: #1a1a1a; text-decoration: none;">
              {heading.text}
            </a>
          </li>
        ))}
      </ul>
    </details>
  </nav>

  <main style="border: 2px solid #1a1a1a; padding: 3rem 2rem; margin: 0 auto 4rem auto; max-width: 72ch; background: #ffffff; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
    <!-- Breadcrumbs -->
    <nav class="breadcrumbs" style="font-size: 0.875rem; color: var(--doc-secondary); margin-bottom: 2rem; font-family: 'IBM Plex Sans', sans-serif;">
      <a href="/" style="color: var(--doc-secondary); text-decoration: none;">Inicio</a>
      <span style="margin: 0 0.5rem;">‚Ä∫</span>
      <a href="/blog" style="color: var(--doc-secondary); text-decoration: none;">Blog</a>
      <span style="margin: 0 0.5rem;">‚Ä∫</span>
      <span style="color: var(--doc-text);">{title}</span>
    </nav>

    <!-- Article Header -->
    <header>
      <span style="display: inline-block; background: #f0f0f0; padding: 0.25rem 0.75rem; text-transform: uppercase; font-size: 0.875rem; font-weight: 600; letter-spacing: 0.05em; color: #1a1a1a; font-family: 'IBM Plex Sans', sans-serif; margin-bottom: 1.5rem;">
        {category}
      </span>
      
      <h1 style="font-family: 'IBM Plex Serif', serif; font-size: 2.5rem; font-weight: 600; line-height: 1.2; margin-bottom: 1.5rem; color: #1a1a1a;">
        {title}
      </h1>
      
      <p style="font-size: 1.125rem; color: #4a4a4a; line-height: 1.6; margin-bottom: 2rem; font-family: 'IBM Plex Sans', sans-serif;">
        {description}
      </p>
      
      <div style="display: flex; gap: 2rem; font-size: 0.875rem; color: #4a4a4a; padding-top: 1.5rem; border-top: 1px solid #e0e0e0; font-family: 'IBM Plex Sans', sans-serif;">
        <span>üìÖ √öltima actualizaci√≥n: {formattedDate}</span>
        <span>‚è±Ô∏è Tiempo de lectura: {readingTime} minutos</span>
      </div>
    </header>

    <!-- Article Content -->
    <article style="margin-top: 4rem;">
      <Content />
    </article>

    <!-- Article Footer -->
    <footer style="border-top: 1px solid #e0e0e0; margin-top: 6rem; padding-top: 2rem; font-family: 'IBM Plex Sans', sans-serif;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <div>
          <p style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #4a4a4a; margin-bottom: 0.5rem;">
            AUTOR
          </p>
          <p style="font-size: 1rem; font-weight: 600; color: #1a1a1a;">
            {author}
          </p>
        </div>
        <div style="text-align: right;">
          <p style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #4a4a4a; margin-bottom: 0.5rem;">
            √öLTIMA ACTUALIZACI√ìN
          </p>
          <p style="font-size: 1rem; color: #1a1a1a;">
            {formattedDate}
          </p>
        </div>
      </div>

      <div style="background: #f8f9fa; border: 1px solid #e0e0e0; padding: 1.5rem; margin-top: 2rem;">
        <p style="font-size: 0.875rem; color: #4a4a4a; font-style: italic; margin: 0; font-family: 'IBM Plex Sans', sans-serif;">
          <strong>Nota Importante:</strong> Esta gu√≠a tiene fines informativos y no constituye asesoramiento legal. 
          Para determinar las obligaciones legales espec√≠ficas de su organizaci√≥n, consulte con un abogado especializado 
          en protecci√≥n de datos y derecho de las telecomunicaciones.
        </p>
      </div>
    </footer>

    <!-- Site Footer -->
    <div style="border-top: 1px solid #e0e0e0; margin-top: 6rem; padding: 3rem 0; background: #fafafa;">
      <div style="max-width: 100%; margin: 0 auto; text-align: center; font-family: 'IBM Plex Sans', sans-serif;">
        <h3 style="font-size: 1.25rem; margin-bottom: 1rem; font-family: 'IBM Plex Serif', serif; color: #1a1a1a;">SMS Legal</h3>
        <p style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #4a4a4a; line-height: 1.8; margin-bottom: 2rem;">
          INFRAESTRUCTURA DE ALTA DISPONIBILIDAD PARA EL CUMPLIMIENTO NORMATIVO.
        </p>
        
        <nav style="margin-bottom: 2rem;">
          <a href="/aviso-legal" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #1a1a1a; text-decoration: none; margin: 0 1rem;">AVISO LEGAL</a>
          <a href="/privacidad" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #1a1a1a; text-decoration: none; margin: 0 1rem;">PRIVACIDAD</a>
          <a href="/terminos" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #1a1a1a; text-decoration: none; margin: 0 1rem;">T√âRMINOS</a>
        </nav>
        
        <p style="font-size: 0.6875rem; color: #4a4a4a; margin-bottom: 1rem;">
          ¬© 2026 SMS LEGAL
        </p>
        <p style="font-size: 0.6875rem; text-transform: uppercase; letter-spacing: 0.1em; color: #4a4a4a;">
          NO COOKIES ¬∑ NO TRACKING ¬∑ PURE DOCUMENT
        </p>
      </div>
    </div>
  </main>
</DocumentoBase>

<style is:global>
  /* Table styling for blog content */
  table {
    width: 100%;
    border-collapse: collapse;
    margin: 2rem 0;
    font-size: 0.875rem;
  }

  th {
    background: var(--doc-bg-dark);
    padding: 0.75rem;
    font-weight: 600;
    border: 1px solid var(--doc-border);
    text-align: left;
  }

  td {
    padding: 0.75rem;
    border: 1px solid var(--doc-border);
  }

  tr:hover {
    background: #f8f9fa;
  }

  /* Checkbox styling */
  input[type="checkbox"] {
    width: 1.25rem;
    height: 1.25rem;
    margin-right: 0.75rem;
    cursor: pointer;
    accent-color: var(--doc-cta);
  }

  /* Content links */
  article a {
    color: var(--doc-link);
    text-decoration: underline;
  }

  article a:hover {
    color: var(--doc-cta);
  }

  /* TOC links */
  .toc-accordion a {
    color: #1a1a1a;
    text-decoration: none;
  }

  .toc-accordion a:hover {
    text-decoration: underline;
  }

  /* Responsive design */
  @media (max-width: 768px) {
    main, .toc-accordion {
      margin: 1rem !important;
      padding: 2rem 1rem !important;
    }

    header h1 {
      font-size: 2rem !important;
    }
  }
</style>
